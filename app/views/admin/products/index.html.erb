<% content_for :title, "Order details" %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center">
    <h1 class="font-bold text-4xl">Products</h1>
    <%= link_to "New product", new_admin_product_path, class: "rounded-md p-2 bg-blue-600 hover:bg-blue-500 text-white block font-medium" %>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 rounded-lg shadow-sm overflow-hidden bg-white">
      <thead class="bg-gray-100">
        <tr>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">Order ID</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">Customer</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">Product</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">Quantity</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">Price</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">Status</th>
          <th scope="col" class="px-6 py-4 text-left text-sm font-semibold text-gray-700 whitespace-nowrap">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-blue-100">
        <% if @admin_order_details.any? %>
          <% @admin_order_details.each do |admin_order_detail| %>
            <tr class="hover:bg-gray-50 transition">
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <%= link_to "##{admin_order_detail.order_id}", admin_order_detail_path(admin_order_detail), class: "hover:underline font-medium" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <%= admin_order_detail.order&.user&.email || "-" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <%= admin_order_detail.variant_detail&.product&.name || "Product ##{admin_order_detail.variant_detail_id}" rescue "-" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <%= admin_order_detail.quantity || "-" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                $<%= number_with_precision(admin_order_detail.price, precision: 2) rescue "-" %>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <% status = admin_order_detail.status || "pending" %>
                <span class="px-2 py-1 rounded-full text-xs font-medium
                  <%= case status.downcase
                      when 'completed' then 'bg-green-100 text-green-800'
                      when 'processing' then 'bg-blue-100 text-blue-800'
                      when 'shipped' then 'bg-purple-100 text-purple-800'
                      when 'cancelled' then 'bg-red-100 text-red-800'
                      when 'refunded' then 'bg-orange-100 text-orange-800'
                      else 'bg-gray-100 text-gray-800'
                      end %>">
                  <%= status.capitalize %>
                </span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                <div class="flex space-x-2">
                  <%= link_to "Show", admin_order_detail_path(admin_order_detail), class: "text-blue-600 hover:text-blue-800 font-medium" %>
                  <%= link_to "Edit", edit_admin_order_detail_path(admin_order_detail), class: "text-green-600 hover:text-green-800 font-medium" %>
                  <%= button_to "Delete", admin_order_detail_path(admin_order_detail), method: :delete, 
                      class: "text-red-600 hover:text-red-800 font-medium cursor-pointer bg-transparent border-0 p-0", 
                      data: { turbo_confirm: "Are you sure?" } %>
                </div>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="7" class="px-6 py-8 text-center text-gray-500">
              No order details found.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>